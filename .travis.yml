language: python

sudo: false

cache: pip

python:
  - "3.4"

env:
  global:
    - secure: "WGau48lYjBwNbr6oAG4AD6Mh335USUKKvDbPKwGNMVn6+UL/bpKtXpSbZuGWj5dUThQqpNb7055Ksvg4jYy42cuE2QVYaKJKoarLGriHPOB53YNlColwDy39mEq+qEFl3BUbZOSXbxTtOHg3QiZwlRrZdJSmk0KzTvcpcBk0Rsw=" # FEC_CF_USERNAME
    - secure: "RH+Fqh3OdJ4MQjCHK33EuqJQ4P+NBTiISbCICLTYgNMa1RLnTFKSCMTTkvBvd86Cw8/b+FRClBn+wp91H37djN4IpOzvKAJm2DhKCFpL57CZ392F6lXw4gugd6xy2MYxdCXUzJw0I+xsm1PMJ0RYeYCR4fg26VrQnOnuOTU7GYs=" # FEC_CF_PASSWORD

before_script:
  - travis_retry pip install -U pip wheel
  - travis_retry pip install -r requirements.txt
  - travis_retry pip install -r requirements.test.txt


  # Use production version of node.js
  - . $HOME/.nvm/nvm.sh
  - nvm install v5.5.0
  - nvm use v5.5.0

  - travis_retry npm install
  - npm run build

script:
  - py.test
  - npm run test-single

after_success:
  - travis_retry pip install codecov
  - codecov

before_deploy:
  - export PATH=$HOME:$PATH
  - travis_retry curl -L -o $HOME/cf.tgz "https://cli.run.pivotal.io/stable?release=linux64-binary&version=6.15.0"
  - tar xzvf $HOME/cf.tgz -C $HOME
  - travis_retry cf install-plugin autopilot -f -r CF-Community
  - npm run build

deploy:
  provider: script
  skip_cleanup: true
  script: invoke deploy --branch $TRAVIS_BRANCH --yes
  on:
    all_branches: true
