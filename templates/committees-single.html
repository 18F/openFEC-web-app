{% extends 'layouts/main.html' %}
{% import 'macros/missing.html' as missing %}
{% import 'macros/null.html' as null %}

{% block title %}
    {{ name }} - Committee Overview
{% endblock %}

{% block body %}
  <div id="main" class="tab-interface">
    <header class="page-header page-header--primary">
    <img class="page-header__icon" src="/static/img/i-committee--primary.svg" alt="Candidate icon">
    <span class="page-header__title">Committees</span>
    {{ search.search('page-header', 'committees') }}
    </header>  
    <header class="entity__header entity__header--primary">
      <div class="container">
        <div class="entity__header__top">
            <h1 class="entity__name">{{ name }}</h1>
            <span class="t-data entity__type">
              {{ committee_type_full }}
               - {{ designation_full }}
               {% if organization %} - {{ organization }}{% endif %}
            </span><span class="t-data">ID: {{ committee_id }}</span>
        </div>
        <div class="entity__header__bottom">
          <ul class="entity__info">
            {% if party_full %}
            <li class="entity__term">
              <span class="entity__term__label">Political Party</span>
              <span class="entity__term__data">{{ party_full }}</span>
            </li>
            {% endif %}
            <li class="entity__term">
              <span class="entity__term__label">Treasurer</span>
              <span class="entity__term__data">{{ treasurer_name }}</span>
            </li>
            {% if candidates %}
            <li class="entity__term">
              <span class="entity__term__label">Related
                {% if candidates|length > 1 %}
                  Candidates
                {% else %}
                  Candidate
                {% endif %}
              </span>
              <ul class="entity__term__data">
              {% for c in candidates %}
                <li><a href="{{ url_for('candidate_page', c_id=c.candidate_id, cycle=cycle) }}">{{ c.name }}</a></li>
              {% endfor %}
              </ul>
            </li>
            {% endif %}
            <li class="entity__term">
              <span class="entity__term__label">Address</span>
              <span class="entity__term__data">{{ street_1 }}{% if street_2 %}<br>{{ street_2 }}{% endif %} <br> {{city}}, {{state}} {{zip}}</span>
            </li>
        </ul>
      </div>
    </header>
    <div class="page-controls page-controls--primary">
      <div class="page-controls__top">
        <div class="container">
          <span class="page-controls__title">{{ name }}</span>
        </div>
      </div>
      <div class="page-controls__bottom">
        <div class="container">
          <nav class="page-tabs">
            <ul class="list--flat" role="tablist" data-name="tab">
              <li role="presentation" class="page-tabs__item"><a role="tab" data-name="summary" tabindex="0" aria-controls="panel1" aria-selected="true" href="#section-1">Financial Summary</a></li>
              <li role="presentation" class="page-tabs__item"><a role="tab" data-name="receipts" tabindex="-1" aria-controls="panel2" href="#section-2">Receipts from Individuals</a></li>
              <li role="presentation" class="page-tabs__item"><a role="tab" data-name="disbursements" tabindex="-1" aria-controls="panel3" href="#section-3">Disbursements</a></li>
              <li role="presentation" class="page-tabs__item"><a role="tab" data-name="transfers" tabindex="-1" aria-controls="panel4" href="#section-4">Between Committees</a></li>
              <li role="presentation" class="page-tabs__item"><a role="tab" data-name="filings" tabindex="-1" aria-controls="panel5" href="#section-5">Filings</a></li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
    
    {% macro totals_table_row(pretty_name, value) %}
      {% import 'macros/charts.html' as charts %}
      <div class="totals-table__row totals-table__row--nested js-accordion_item" aria-hidden="true">
        <div class="totals-table__cell">{{ pretty_name }} </div>
        <div class="totals-table__cell">{{ null.null(value | currency) }}</div>
        <div class="totals-table__cell totals-table__cell--bar">
          <div class="bar-container">
            {{ charts.chart_bar(value|default(0),
                                pretty_name,
                                tooltip=None) }}
          </div>
        </div>
      </div>
    {% endmacro %}

    {% macro totals_table_row_header(pretty_name, value, description, accordion=True) %}
      <div class="totals-table__row totals-table__row--header js-accordion_header accordion__header">
        <div class="totals-table__cell">
          <span class="totals-table__label">{{ pretty_name }}</span>
          {% if description %}
          <span class="t-note"><em>{{ description }}</em></span>
          {% endif %}
        </div>
        <div class="totals-table__cell">
          <span>{{ null.null( value | currency ) }}</span>
        </div>
        {% if accordion %}
          <button class="button button--primary accordion__button js-accordion_button"></button>
        {% endif %}
      </div>
    {% endmacro %}

    {% macro totals_table(header_name, header_value, data, report_year, header_description='') %}
      <figure class="totals-table totals-table--charts js-chart-series chart-series--horizontal">
        {{ totals_table_row_header(header_name, header_value, header_description, accordion=data|length) }}
        {% for item in data %}
          {{ totals_table_row(item[1], item[0]) }}
        {% endfor %}
      </figure>
    {% endmacro %}

    <section class="main" id="section-1" role="tabpanel" aria-hidden="false" aria-labelledby="section-1-heading">
      <div class="container">
        <div class="content__section">
          <div class="section__heading">
            <h2 class="heading__title" id="section-1-heading">Financial Summary {% include 'partials/cycle-select.html' %}</h2>
          </div>
          <p>Get the full picture of all of the money received and spent by this committee.</p>
        </div>
        {% if reports and totals %}
          <div class="content__section">
              {% with committee=context() %}
            <h3 class="results-info results-info--simple results-info__title">Detailed Summary {{ reports.0.cycle-1 }} - {{ reports.0.cycle }}</h3>
            <div class="js-accordion">
            {% if committee_type == 'P' %}
              {% include 'partials/committee-totals-presidential.html' %}
            {% elif committee_type == 'H' or committee_type == 'S' %}
              {% include 'partials/committee-totals-house-senate.html' %}
            {% elif committee_type == 'I' %}
              {% include 'partials/committee-totals-ie-only.html' %}
            {% else %}
              {% include 'partials/committee-totals-pac-party.html' %}
            {% endif %}
            </div>

            {% if committee_type != 'I'  %}
              {% include 'partials/committee-charts.html' %}
            {% else %}
              {% include 'partials/ie-chart.html' %}
            {% endif %}
            {% endwith %}
        {% else %}

          {{ missing.missing_financials('committee', cycle) }}

        {% endif %}
      </div>
    </section>

    {% with committee=context() %}
    {% include 'partials/receipts-tab.html' %}
    {% include 'partials/disbursements-tab.html' %}
    {% include 'partials/between-committees-tab.html' %}
    {% include 'partials/filings-tab-committee.html' %}
    {% endwith %}
  </div>

{% endblock %}

{% block scripts %}
<script src="/{{ assets['dist/js/pages/committee-single.js'] }}"></script>
{% endblock %}
