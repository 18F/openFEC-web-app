{% extends 'layouts/main.html' %}

{% block title %}
    {{name | title}} - Committee Overview
{% endblock %}

{% block header %}
    {% include 'partials/page-nav.html' %}
{% endblock %}

{% block body %}
  <div id="main" class="entity committee tab-interface">
    <header class="entity__header page-header page-header--dark">
      <div class="container">
        <div class="entity__header--top row">
            <span class="entity__id">ID: {{ committee_id }}</span>
            <h1 class="entity__name">{{ name }}</h1>
            <span class="entity__type">
              <img class="category-icon"
                   width="20" height="20"
                   src="/static/img/icon-committee--white.svg"
                   alt="Icon representing committees">
               Committee - {{ designation_full }}
               - {{ committee_type_full }}
               {% if organization %} - {{ organization }}{% endif %}
            </span>
        </div>
        <div class="entity__header--bottom row">
          <ul class="entity__info">
            {% if party %}
            <li class="entity__term">
              <h5 class="entity__term__label">Political Party</h5>
              <span class="entity__term__data">{{ party }}</span>
            </li>
            {% endif %}
            <li class="entity__term">
              <h5 class="entity__term__label">Treasurer</h5>
              <span class="entity__term__data">{{ treasurer_name }}</span>
            </li>
            {% if candidates %}
            <li class="entity__term">
              <h5 class="entity__term__label">Related Candidates</h5>
              <ul class="entity__term__data">
              {% for c in candidates %}
                <li><a href="{{ url_for('candidate_page', c_id=c.candidate_id) }}">{{ c.name }}</a></li>
              {% endfor %}
              </ul>
            </li>
            <li class="entity__term">
              <h5 class="entity__term__label">Address</h5>
              <span class="entity__term__data">{{ street_1 }}{% if street_2 %}<br>{{ street_2 }}{% endif %} <br> {{city}}, {{state}} {{zip}}</span>
            </li>
          {% endif %}
        </ul>
      </div>
    </header>
    <div class="page-controls page-controls--dark">
      <div class="page-controls__top">
        <div class="container">
          <span class="page-controls__title"><img class="category-icon" width="16" height="16" src="/static/img/icon-committee--white.svg" alt="Icon representing committees"> {{ name }}</span>
        </div>
      </div>
      <div class="page-controls__bottom">
        <div class="container">
          {% if election_years %}
          <div class="time-period">
            <label for="election_cycle">Two-Year Period</label>
            <select name="election_cycle" data-id="{{ candidate_id }}" data-type="candidate">
            {% for year in election_years|sort(reverse=True) %}
              <option value="{{ year }}">{{ year|int - 1 }} - {{ year }}</option>
            {% endfor %}
            </select>
          </div>
          {% endif %}
        </div>
      </div>
     <!-- <nav class="page-tabs">
        <div class="container">
          <ul role="tablist">
            <li role="presentation" class="page-tabs__item"><a role="tab" tabindex="0" aria-controls="panel1" aria-selected="true" href="#section-1">Financial Overview</a></li>
            <li role="presentation" class="page-tabs__item"><a role="tab" tabindex="-1" aria-controls="panel2" href="#section-2">Report Summaries</a></li>
            <li role="presentation" class="page-tabs__item"><a role="tab" tabindex="-1" aria-controls="panel3" href="#section-3">Browse All Filings</a></li>
          </ul>
        </div>
      </nav> -->
    </div>
{% macro totals_table_row(pretty_name, value) %}
      {% import 'macros/charts.html' as charts %}
      <div class="table__row table__row--nested js-accordion_item">
        <div class="table__cell">{{ pretty_name }} </div>
        <div class="table__cell">{{ value|default(0)|currency }}</div>
        <div class="table__cell table__cell--bar">
          {{ charts.chart_bar(value|default(0),
                              pretty_name,
                              tooltip=None) }}
        </div>
      </div>
    {% endmacro %}

    {% macro totals_table_row_header(pretty_name, value, description, accordion=True) %}
      <div class="table__row table__row--header js-accordion_header accordion__header">
        <div class="table__cell">
          <h5>{{ pretty_name }}</h5>
        </div>
        <div class="table__cell">
          <span>{{ value|default(0)|currency }}</span>
        </div>
        {% if description %}
        <div class="table__cell table__cell--header-description">
          <span class="text--black"><em>{{ description }}</em></span>
        </div>
        {% endif %}
        {% if accordion %}
          <a href="#" class="accordion__button js-accordion_button">
          </a>
        {% endif %}
      </div>
    {% endmacro %}

    {% macro totals_table(header_name, header_value, data, report_year, header_description='') %}
      <figure class="table--simple totals-table totals-table--charts">
        <div class="table js-chart-series chart-series--horizontal">
          {{ totals_table_row_header(header_name, header_value, header_description, accordion=data|length) }}
          {% for item in data %}
            {{ totals_table_row(item[1], item[0]) }}
          {% endfor %}
        </div>
      </figure>
    {% endmacro %}

    <section class="page-section" id="section-1" role="tabpanel" aria-hidden="false" aria-labelledby="section-1-header">
      <div class="container committee-summary">
        {% if totals %}
          <h2 id="section-1-header" tabindex="0">Financial Summary</h2>
          <p class="text--lead">Get the full picture of all of the money received and spent by this committee.</p>
          <div class="page-subsection page-subsection--noline">
            <div class="row js-accordion meta-box recent-report">
              {% with committee=context() %}
              <div class="meta-box__bar">
                <h4>Most Recent Report:
                  <a href="http://docquery.fec.gov/pdf/{{ committee.reports[0].beginning_image_number|last_n_characters }}/{{ committee.reports[0].beginning_image_number }}/{{ committee.reports[0].beginning_image_number }}.pdf">{{ committee.reports[0].report_year }} {{committee.reports[0].report_type_full|fmt_report_desc}}</a>
                </h4>
               <span>Report coverage: {{ committee.reports.0.coverage_start_date|date_md }} - {{ committee.reports.0.coverage_end_date|date_md }} | <a href="http://docquery.fec.gov/pdf/{{ committee.reports[0].beginning_image_number|last_n_characters }}/{{ committee.reports[0].beginning_image_number }}/{{ committee.reports[0].beginning_image_number }}.pdf">View PDF &raquo;</a></span>
              </div>
               {% set table_data = [
                   (committee.reports.0.individual_itemized_contributions_period, 'Itemized Individual Contributions'),
                   (committee.reports.0.individual_unitemized_contributions_period, 'Unitemized Individual Contributions'),
                   (committee.reports.0.transfers_to_affiliated_committee_period, 'Transfer from authorized committees'),
                   (committee.reports.0.all_loans_received_period, 'Loans'),
                 ]
              %}
              {{ totals_table('Total Receipts', committee.reports.0.total_receipts_period, table_data,
                  committee.report_year, header_description='' ) }}
              {% set table_data = [
                   (committee.reports.0.total_operating_expenditures_period, 'Operating expenditures'),
                   (committee.reports.0.transfers_to_affiliated_committee_period, 'Transfers to affiliated committees'),
                   (committee.reports.0.loan_repayments_made_period, 'Total loan repayments'),
                   (committee.reports.0.total_contribution_refunds_period, 'Contribution refunds'),
                   (committee.reports.0.other_disbursements_period, 'Other disbursements'),
                 ]
              %}
              {{ totals_table('Total Disbursements', committee.reports[0].total_disbursements_period, table_data,
                  committee.report_year, header_description='' ) }}
              {{ totals_table('Beginning cash on hand', reports.0.cash_on_hand_beginning_period) }}
              {{ totals_table('End cash on hand', reports.0.cash_on_hand_end_period) }}
              {{ totals_table('Debts owed to committee', reports.0.debts_owed_to_committee) }}
              {{ totals_table('Debts owed by committee', reports.0.debts_owed_by_committee) }}
            </div>
            <h3 class="section-header">Detailed Summary</h3>
            <!-- TODO: 'Transfer from a Committee' needs to reference a field available for all committee types (PacOrParty does not have it) -->
            {% set table_data = [
                 (totals.0.individual_itemized_contributions, 'Itemized Individual Contributions'),
                 (totals.0.individual_unitemized_contributions, 'Unitemized Individual Contributions'),
                 (totals.0.transfers_to_affiliated_committee, 'Transfer to a Committee'),
                 (totals.0.all_loans_received, 'Loans'),
               ]
            %}
            {{ totals_table('Total receipts', totals.0.receipts, table_data,
                report_year, header_description='Money received by the committee' ) }}

                <!-- TODO: These are not valid field names, figure out what they should be
                 (totals.0.transfers_to_affiliated_committee, 'Fundraisings'),
                 (totals.0.transfers_to_affiliated_committee, 'Exempt legal and accounting'),
                -->
            {% set table_data = [
                 (totals.0.operating_expenditures, 'Operating expenditures'),
                 (totals.0.transfers_to_affiliated_committee, 'Transfers to authorized committees'),
                 (totals.0.loan_repayments_made, 'Total loan repayments'),
                 (totals.0.contribution_refunds, 'Contribution refunds'),
                 (totals.0.other_disbursements, 'Other disbursements'),
               ]
            %}
            {{ totals_table('Total Disbursements', totals.0.disbursements, table_data,
                report_year, header_description='Money spent by the committee' ) }}
          </div>
          <div class="row">
            {% include 'partials/committee-charts.html' %}
            {% endwith %}
          </div>
        {% else %}

        <div class="meta-box error-container">
          <h2 id="section-1-header" tabindex="0">No financial data</h2>
          <p class="text--lead">This committee has not filed any <a class="term" data-term="Reports and Statements">reports</a> for the time period selected. Right now, OpenFEC provides summary information using Forms 3, 3P and 3X. For complete data, search the <a href="http://www.fec.gov/finance/disclosure/candcmte_info.shtml">FEC Candidate and Committee Viewer</a>.</p>
          <div class="error-container__bottom">
              <h5>Is this information incorrect? Let us know.</h5>
              <a class="button" href="mailto:{{ contact_email }}">Contact support <i class="ti-email"></i></a>
         </div>
        </div>
        {% endif %}
      </div>
    </section>
  </div>

{% endblock %}

{% block scripts %}
  <script src="/static/js/vendor/tablist.js"></script>
{% endblock %}
